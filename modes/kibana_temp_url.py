import requests
import json
import os
from dotenv import load_dotenv
from pathlib import Path

env_path = Path(".") / ".env"
print(env_path)
load_dotenv(dotenv_path=env_path)
auth_key = os.environ['AUTH_KEY']
kibana_int = os.environ['KIBANA_INT']
kibana_temp = os.environ['KIBANA_TEMP']


def kibana_temp_link(org_id ,netloc) -> str:
    # dashboard = {'title': 'crawlera-mukthy', 'services': {'query': {'list': {'0': {'query': 'subtype:*', 'alias': 'all', 'color': '#052B51', 'id': 0, 'pin': True, 'type': 'lucene', 'enable': True}, '1': {'id': 1, 'color': '#629E51', 'alias': 'requests', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:request AND NOT _exists_:error_details'}, '2': {'id': 2, 'color': '#BF1B00', 'alias': 'bans', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:ban'}, '3': {'id': 3, 'color': '#EF843C', 'alias': 'unbans', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:unban'}, '4': {'id': 4, 'color': '#EAB839', 'alias': 'requests w/ errors', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:request AND _exists_:error_details'}, '5': {'id': 5, 'color': '#1F78C1', 'alias': 'all requests', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:request'}, '6': {'id': 6, 'color': '#BA43A9', 'alias': '', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:concurrency'}, '7': {'id': 7, 'color': '#6ED0E0', 'alias': 'data_loss', 'pin': True, 'type': 'lucene', 'enable': True, 'query': 'subtype:request AND _exists_:data_loss'}, '8': {'alias': '', 'pin': False, 'type': 'lucene', 'enable': True, 'query': 'hostname:www.yelp.com', 'color': '#508642', 'id': 8}}, 'ids': [0, 1, 2, 3, 4, 5, 6, 7, 8]}, 'filter': {'list': {'0': {'type': 'time', 'field': '@timestamp', 'from': 'now-24h', 'to': 'now', 'mandate': 'must', 'active': True, 'alias': '', 'id': 0}, '2': {'type': 'terms', 'field': 'netloc', 'value': 'yelp.com', 'mandate': 'must', 'active': True, 'alias': '', 'id': 2}, '4': {'type': 'field', 'field': 'organization_id', 'query': '531204', 'mandate': 'must', 'active': True, 'alias': '', 'id': 4}}, 'ids': [0, 2, 4]}}, 'rows': [{'title': 'Crawlera servers & User Agents', 'height': '150px', 'editable': True, 'collapse': False, 'collapsable': True, 'panels': [{'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'master', 'exclude': [], 'missing': False, 'other': False, 'size': 20, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Crawlera Master Tags'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'sep_host.raw', 'exclude': [], 'missing': False, 'other': False, 'size': 20, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Sep Worker Hosts'}, {'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'ua.raw', 'exclude': [], 'missing': True, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'User Agents'}], 'notice': False}, {'title': 'Log types', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 6, 'editable': True, 'group': ['default'], 'type': 'terms', 'queries': {'mode': 'selected', 'ids': [0]}, 'field': 'subtype', 'exclude': [], 'missing': False, 'other': False, 'size': 20, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'none', 'title': 'Log types', 'spyable': True, 'tmode': 'terms', 'tstat': 'total', 'valuefield': ''}], 'notice': False}, {'title': 'Users and Orgs (for Requests)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'user', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 10 Requests Users'}, {'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'organization_id', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'count', 'valuefield': '', 'title': 'Top 10 Orgs in Requests'}, {'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'country', 'exclude': [], 'missing': False, 'other': True, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'count', 'valuefield': '', 'title': 'Top 10 Countries'}], 'notice': False}, {'title': 'Netlocs and Hostnames (for Requests)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'netloc', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 10 Requests Netlocs'}, {'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'hostname', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 10 Requests Hostnames'}], 'notice': False}, {'title': 'Errors', 'height': '250px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'user', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [4]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 10 users with errors'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'code', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [4]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Status codes'}, {'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'error_details.raw', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [0]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'error_details'}, {'error': False, 'span': 2, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'country', 'exclude': [], 'missing': False, 'other': True, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [4]}, 'tmode': 'terms', 'tstat': 'count', 'valuefield': '', 'title': 'Errors per Country'}], 'notice': False}, {'title': 'Proxy providers (for requests)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'provider', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 10 proxy providers'}, {'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'country', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Proxy Countries'}], 'notice': False}, {'title': 'Proxies (for requests)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 12, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'proxy_ip', 'exclude': [], 'missing': False, 'other': False, 'size': 20, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Top 20 Requests Slaves'}], 'notice': False}, {'title': 'Requests (plot)', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'count', 'time_field': '@timestamp', 'value_field': None, 'x-axis': True, 'y-axis': True, 'scale': 1, 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [1, 2, 4, 7]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': False, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': True, 'stack': True, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Requests'}], 'notice': False}, {'title': 'Response Body Size (plot)', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'sum', 'time_field': '@timestamp', 'value_field': 'body_size', 'x-axis': True, 'y-axis': True, 'scale': 1, 'y_format': 'bytes', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [1]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '30s', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': False, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': True, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Body size (total)'}], 'notice': False}, {'title': 'Requests Tops (netlocs, users, status codes, xheaders)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'netloc', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Netlocs'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'user', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Users'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'code', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Codes'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'xheaders.raw', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'X-Crawlera headers'}], 'notice': False}, {'title': 'Requests job IDs', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'jobid', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [5]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Job IDs'}], 'notice': False}, {'title': 'Client IPs', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 4, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'peer', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [0]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Client IPs'}], 'notice': False}, {'title': 'Bans (plot)', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'count', 'time_field': '@timestamp', 'value_field': None, 'x-axis': True, 'y-axis': True, 'scale': 1, 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [2, 3]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '30s', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': False, 'fill': 0, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': True, 'stack': True, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Bans+unbans'}], 'notice': False}, {'title': 'Bans (netlocs, users, ban rules)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'netloc', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [2]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Netlocs'}, {'error': False, 'span': 3, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'user', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [2]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Users'}, {'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'rule', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [2]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Ban rules'}], 'notice': False}, {'title': 'Banned proxies (slave IPs, slave providers)', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'proxy_ip', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [2]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Slave IPs'}, {'error': False, 'span': 6, 'editable': True, 'type': 'terms', 'loadingEditor': False, 'field': 'provider', 'exclude': [], 'missing': False, 'other': False, 'size': 10, 'order': 'count', 'style': {'font-size': '10pt'}, 'donut': False, 'tilt': False, 'labels': True, 'arrangement': 'horizontal', 'chart': 'table', 'counter_pos': 'above', 'spyable': True, 'queries': {'mode': 'selected', 'ids': [2]}, 'tmode': 'terms', 'tstat': 'total', 'valuefield': '', 'title': 'Providers'}], 'notice': False}, {'title': 'Max Ban count (makes sense when filtering by netloc)', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'max', 'time_field': '@timestamp', 'value_field': 'bancount', 'x-axis': True, 'y-axis': True, 'scale': 1, 'y_format': 'none', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [2]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '30s', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': False, 'fill': 0, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': True, 'stack': True, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': False, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Max ban count'}], 'notice': False}, {'title': 'Max delays over time', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'max', 'time_field': '@timestamp', 'value_field': 'delay', 'x-axis': True, 'y-axis': True, 'scale': '0.001', 'y_format': 'none', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Max Delay (seconds)'}], 'notice': False}, {'title': 'Mean delay over time', 'height': '300px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'avg', 'time_field': '@timestamp', 'value_field': 'delay', 'x-axis': True, 'y-axis': True, 'scale': '0.001', 'y_format': 'none', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '30s', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Mean delay (seconds)'}], 'notice': False}, {'title': 'Times', 'height': '150px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'avg', 'time_field': '@timestamp', 'value_field': 'total_time', 'x-axis': True, 'y-axis': True, 'scale': '0.001', 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Total response time (seconds)'}, {'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'max', 'time_field': '@timestamp', 'value_field': 'proxy_time', 'x-axis': True, 'y-axis': True, 'scale': '0.001', 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Proxy time (seconds)'}, {'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'max', 'time_field': '@timestamp', 'value_field': 'proxy_react_time', 'x-axis': True, 'y-axis': True, 'scale': '0.001', 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Proxy reaction time (seconds)'}, {'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'max', 'time_field': '@timestamp', 'value_field': 'events.created', 'x-axis': True, 'y-axis': True, 'scale': '1', 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Max. Time between Started and Created (seconds)'}, {'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'avg', 'time_field': '@timestamp', 'value_field': 'events.created', 'x-axis': True, 'y-axis': True, 'scale': '1', 'y_format': 'short', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [5]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': True, 'resolution': 100, 'interval': '10m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': True, 'fill': 1, 'linewidth': 1, 'points': False, 'pointradius': 5, 'bars': False, 'stack': False, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Avg. Time between Started and Created (seconds)'}], 'notice': False}, {'title': 'Concurrency Info', 'height': '350px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'span': 12, 'editable': True, 'type': 'histogram', 'loadingEditor': False, 'mode': 'sum', 'time_field': '@timestamp', 'value_field': 'concurrent_connections_count', 'x-axis': True, 'y-axis': True, 'scale': 1, 'y_format': 'none', 'grid': {'max': None, 'min': 0}, 'queries': {'mode': 'selected', 'ids': [6]}, 'annotate': {'enable': False, 'query': '*', 'size': 20, 'field': '_type', 'sort': ['_score', 'desc']}, 'auto_int': False, 'resolution': 100, 'interval': '1m', 'intervals': ['auto', '1s', '1m', '5m', '10m', '30m', '1h', '3h', '12h', '1d', '1w', '1y'], 'lines': False, 'fill': 0, 'linewidth': 3, 'points': False, 'pointradius': 5, 'bars': True, 'stack': True, 'spyable': True, 'zoomlinks': True, 'options': True, 'legend': True, 'show_query': True, 'interactive': True, 'legend_counts': True, 'timezone': 'utc', 'percentage': False, 'zerofill': True, 'derivative': False, 'tooltip': {'value_type': 'cumulative', 'query_as_alias': True}, 'title': 'Concurrent connections'}], 'notice': False}, {'title': 'Event browser (table)', 'height': '650px', 'editable': True, 'collapse': True, 'collapsable': True, 'panels': [{'error': False, 'span': 12, 'editable': True, 'group': ['default'], 'type': 'table', 'size': 25, 'pages': 5, 'offset': 0, 'sort': ['@timestamp', 'desc'], 'style': {'font-size': '9pt'}, 'overflow': 'min-height', 'fields': ['@timestamp', 'master', 'subtype', 'user', 'jobid', 'netloc', 'hostname', 'url', 'rule', 'error_details', 'reason', 'bancount'], 'highlight': [], 'sortable': True, 'header': True, 'paging': True, 'spyable': True, 'queries': {'mode': 'selected', 'ids': [0]}, 'field_list': False, 'status': 'Stable', 'trimFactor': 300, 'normTimes': True, 'title': 'Events', 'all_fields': False, 'localTime': False, 'timeField': '@timestamp'}], 'notice': False}], 'editable': True, 'index': {'interval': 'day', 'pattern': '[logstash-crawlera-requests-]YYYY.MM.DD', 'default': '_all', 'warm_fields': True}, 'style': 'light', 'failover': False, 'panel_hints': True, 'loader': {'save_gist': False, 'save_elasticsearch': True, 'save_local': True, 'save_default': True, 'save_temp': True, 'save_temp_ttl_enable': True, 'save_temp_ttl': '30d', 'load_gist': True, 'load_elasticsearch': True, 'load_elasticsearch_size': 20, 'load_local': True, 'hide': False}, 'pulldowns': [{'type': 'query', 'collapse': False, 'notice': False, 'query': '*', 'pinned': True, 'history': ['subtype:concurrency', 'subtype:request', 'subtype:request AND _exists_:error_details', 'subtype:unban', 'subtype:ban', 'subtype:request AND _missing_:error_details', 'subtype:*', 'logtype:request', 'logtype:request AND _exists_:error', 'logtype:unban'], 'remember': 10, 'enable': True}, {'type': 'filtering', 'collapse': False, 'notice': True, 'enable': True}], 'nav': [{'type': 'timepicker', 'collapse': False, 'notice': False, 'status': 'Stable', 'time_options': ['5m', '15m', '30m', '1h', '3h', '6h', '12h', '24h', '2d', '3d', '5d', '7d', '15d'], 'refresh_intervals': ['30s', '1m', '5m', '15m', '30m', '1h'], 'timefield': '@timestamp', 'enable': True, 'now': True, 'filter_id': 0}], 'refresh': False}
    dashboard = "{\"title\":\"crawlera-mukthy\",\"services\":{\"query\":{\"list\":{\"0\":{\"query\":\"subtype:*\",\"alias\":\"all\",\"color\":\"#052B51\",\"id\":0,\"pin\":true,\"type\":\"lucene\",\"enable\":true},\"1\":{\"id\":1,\"color\":\"#629E51\",\"alias\":\"requests\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:request AND NOT _exists_:error_details\"},\"2\":{\"id\":2,\"color\":\"#BF1B00\",\"alias\":\"bans\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:ban\"},\"3\":{\"id\":3,\"color\":\"#EF843C\",\"alias\":\"unbans\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:unban\"},\"4\":{\"id\":4,\"color\":\"#EAB839\",\"alias\":\"requests w/ errors\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:request AND _exists_:error_details\"},\"5\":{\"id\":5,\"color\":\"#1F78C1\",\"alias\":\"all requests\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:request\"},\"6\":{\"id\":6,\"color\":\"#BA43A9\",\"alias\":\"\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:concurrency\"},\"7\":{\"id\":7,\"color\":\"#6ED0E0\",\"alias\":\"data_loss\",\"pin\":true,\"type\":\"lucene\",\"enable\":true,\"query\":\"subtype:request AND _exists_:data_loss\"}},\"ids\":[0,1,2,3,4,5,6,7]},\"filter\":{\"list\":{\"0\":{\"type\":\"time\",\"field\":\"@timestamp\",\"from\":\"now-24h\",\"to\":\"now\",\"mandate\":\"must\",\"active\":true,\"alias\":\"\",\"id\":0},\"2\":{\"type\":\"terms\",\"field\":\"netloc\",\"value\":\"yelp.com\",\"mandate\":\"must\",\"active\":true,\"alias\":\"\",\"id\":2},\"4\":{\"type\":\"field\",\"field\":\"organization_id\",\"query\":\"531204\",\"mandate\":\"must\",\"active\":true,\"alias\":\"\",\"id\":4}},\"ids\":[0,2,4]}},\"rows\":[{\"title\":\"Crawlera servers & User Agents\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"master\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":20,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Crawlera Master Tags\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"sep_host.raw\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":20,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Sep Worker Hosts\"},{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"ua.raw\",\"exclude\":[],\"missing\":true,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"User Agents\"}],\"notice\":false},{\"title\":\"Log types\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":6,\"editable\":true,\"group\":[\"default\"],\"type\":\"terms\",\"queries\":{\"mode\":\"selected\",\"ids\":[0]},\"field\":\"subtype\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":20,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"none\",\"title\":\"Log types\",\"spyable\":true,\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\"}],\"notice\":false},{\"title\":\"Users and Orgs (for Requests)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"user\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 10 Requests Users\"},{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"organization_id\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"count\",\"valuefield\":\"\",\"title\":\"Top 10 Orgs in Requests\"},{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"country\",\"exclude\":[],\"missing\":false,\"other\":true,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"count\",\"valuefield\":\"\",\"title\":\"Top 10 Countries\"}],\"notice\":false},{\"title\":\"Netlocs and Hostnames (for Requests)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"netloc\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 10 Requests Netlocs\"},{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"hostname\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 10 Requests Hostnames\"}],\"notice\":false},{\"title\":\"Errors\",\"height\":\"250px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"user\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[4]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 10 users with errors\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"code\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[4]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Status codes\"},{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"error_details.raw\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[0]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"error_details\"},{\"error\":false,\"span\":2,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"country\",\"exclude\":[],\"missing\":false,\"other\":true,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[4]},\"tmode\":\"terms\",\"tstat\":\"count\",\"valuefield\":\"\",\"title\":\"Errors per Country\"}],\"notice\":false},{\"title\":\"Proxy providers (for requests)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"provider\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 10 proxy providers\"},{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"country\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Proxy Countries\"}],\"notice\":false},{\"title\":\"Proxies (for requests)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":12,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"proxy_ip\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":20,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Top 20 Requests Slaves\"}],\"notice\":false},{\"title\":\"Requests (plot)\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"count\",\"time_field\":\"@timestamp\",\"value_field\":null,\"x-axis\":true,\"y-axis\":true,\"scale\":1,\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[1,2,4,7]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"10m\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":false,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":true,\"stack\":true,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Requests\"}],\"notice\":false},{\"title\":\"Response Body Size (plot)\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"sum\",\"time_field\":\"@timestamp\",\"value_field\":\"body_size\",\"x-axis\":true,\"y-axis\":true,\"scale\":1,\"y_format\":\"bytes\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[1]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":false,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":true,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Body size (total)\"}],\"notice\":false},{\"title\":\"Requests Tops (netlocs, users, status codes, xheaders)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"netloc\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Netlocs\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"user\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Users\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"code\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Codes\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"xheaders.raw\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"X-Crawlera headers\"}],\"notice\":false},{\"title\":\"Requests job IDs\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"jobid\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Job IDs\"}],\"notice\":false},{\"title\":\"Client IPs\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":4,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"peer\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[0]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Client IPs\"}],\"notice\":false},{\"title\":\"Bans (plot)\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"count\",\"time_field\":\"@timestamp\",\"value_field\":null,\"x-axis\":true,\"y-axis\":true,\"scale\":1,\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[2,3]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":false,\"fill\":0,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":true,\"stack\":true,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Bans+unbans\"}],\"notice\":false},{\"title\":\"Bans (netlocs, users, ban rules)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"netloc\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Netlocs\"},{\"error\":false,\"span\":3,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"user\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Users\"},{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"rule\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Ban rules\"}],\"notice\":false},{\"title\":\"Banned proxies (slave IPs, slave providers)\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"proxy_ip\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Slave IPs\"},{\"error\":false,\"span\":6,\"editable\":true,\"type\":\"terms\",\"loadingEditor\":false,\"field\":\"provider\",\"exclude\":[],\"missing\":false,\"other\":false,\"size\":10,\"order\":\"count\",\"style\":{\"font-size\":\"10pt\"},\"donut\":false,\"tilt\":false,\"labels\":true,\"arrangement\":\"horizontal\",\"chart\":\"table\",\"counter_pos\":\"above\",\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"tmode\":\"terms\",\"tstat\":\"total\",\"valuefield\":\"\",\"title\":\"Providers\"}],\"notice\":false},{\"title\":\"Max Ban count (makes sense when filtering by netloc)\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"bancount\",\"x-axis\":true,\"y-axis\":true,\"scale\":1,\"y_format\":\"none\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[2]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":false,\"fill\":0,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":true,\"stack\":true,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":false,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Max ban count\"}],\"notice\":false},{\"title\":\"Max delays over time\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"delay\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"0.001\",\"y_format\":\"none\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"10m\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Max Delay (seconds)\"}],\"notice\":false},{\"title\":\"Mean delay over time\",\"height\":\"300px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"avg\",\"time_field\":\"@timestamp\",\"value_field\":\"delay\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"0.001\",\"y_format\":\"none\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Mean delay (seconds)\"}],\"notice\":false},{\"title\":\"Times\",\"height\":\"150px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"total_time\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"0.001\",\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Total response time (seconds)\"},{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"proxy_time\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"0.001\",\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Proxy time (seconds)\"},{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"proxy_react_time\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"0.001\",\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Proxy reaction time (seconds)\"},{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"max\",\"time_field\":\"@timestamp\",\"value_field\":\"events.created\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"1\",\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Max. Time between Started and Created (seconds)\"},{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"avg\",\"time_field\":\"@timestamp\",\"value_field\":\"events.created\",\"x-axis\":true,\"y-axis\":true,\"scale\":\"1\",\"y_format\":\"short\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[5]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":true,\"resolution\":100,\"interval\":\"30s\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":true,\"fill\":1,\"linewidth\":1,\"points\":false,\"pointradius\":5,\"bars\":false,\"stack\":false,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Avg. Time between Started and Created (seconds)\"}],\"notice\":false},{\"title\":\"Concurrency Info\",\"height\":\"350px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"span\":12,\"editable\":true,\"type\":\"histogram\",\"loadingEditor\":false,\"mode\":\"sum\",\"time_field\":\"@timestamp\",\"value_field\":\"concurrent_connections_count\",\"x-axis\":true,\"y-axis\":true,\"scale\":1,\"y_format\":\"none\",\"grid\":{\"max\":null,\"min\":0},\"queries\":{\"mode\":\"selected\",\"ids\":[6]},\"annotate\":{\"enable\":false,\"query\":\"*\",\"size\":20,\"field\":\"_type\",\"sort\":[\"_score\",\"desc\"]},\"auto_int\":false,\"resolution\":100,\"interval\":\"1m\",\"intervals\":[\"auto\",\"1s\",\"1m\",\"5m\",\"10m\",\"30m\",\"1h\",\"3h\",\"12h\",\"1d\",\"1w\",\"1y\"],\"lines\":false,\"fill\":0,\"linewidth\":3,\"points\":false,\"pointradius\":5,\"bars\":true,\"stack\":true,\"spyable\":true,\"zoomlinks\":true,\"options\":true,\"legend\":true,\"show_query\":true,\"interactive\":true,\"legend_counts\":true,\"timezone\":\"utc\",\"percentage\":false,\"zerofill\":true,\"derivative\":false,\"tooltip\":{\"value_type\":\"cumulative\",\"query_as_alias\":true},\"title\":\"Concurrent connections\"}],\"notice\":false},{\"title\":\"Event browser (table)\",\"height\":\"650px\",\"editable\":true,\"collapse\":true,\"collapsable\":true,\"panels\":[{\"error\":false,\"span\":12,\"editable\":true,\"group\":[\"default\"],\"type\":\"table\",\"size\":25,\"pages\":5,\"offset\":0,\"sort\":[\"@timestamp\",\"desc\"],\"style\":{\"font-size\":\"9pt\"},\"overflow\":\"min-height\",\"fields\":[\"@timestamp\",\"master\",\"subtype\",\"user\",\"jobid\",\"netloc\",\"hostname\",\"url\",\"rule\",\"error_details\",\"reason\",\"bancount\"],\"highlight\":[],\"sortable\":true,\"header\":true,\"paging\":true,\"spyable\":true,\"queries\":{\"mode\":\"selected\",\"ids\":[0]},\"field_list\":false,\"status\":\"Stable\",\"trimFactor\":300,\"normTimes\":true,\"title\":\"Events\",\"all_fields\":false,\"localTime\":false,\"timeField\":\"@timestamp\"}],\"notice\":false}],\"editable\":true,\"index\":{\"interval\":\"day\",\"pattern\":\"[logstash-crawlera-requests-]YYYY.MM.DD\",\"default\":\"_all\",\"warm_fields\":true},\"style\":\"light\",\"failover\":false,\"panel_hints\":true,\"loader\":{\"save_gist\":false,\"save_elasticsearch\":true,\"save_local\":true,\"save_default\":true,\"save_temp\":true,\"save_temp_ttl_enable\":true,\"save_temp_ttl\":\"30d\",\"load_gist\":true,\"load_elasticsearch\":true,\"load_elasticsearch_size\":20,\"load_local\":true,\"hide\":false},\"pulldowns\":[{\"type\":\"query\",\"collapse\":false,\"notice\":false,\"query\":\"*\",\"pinned\":true,\"history\":[\"subtype:concurrency\",\"subtype:request\",\"subtype:request AND _exists_:error_details\",\"subtype:unban\",\"subtype:ban\",\"subtype:request AND _missing_:error_details\",\"subtype:*\",\"logtype:request\",\"logtype:request AND _exists_:error\",\"logtype:unban\"],\"remember\":10,\"enable\":true},{\"type\":\"filtering\",\"collapse\":false,\"notice\":true,\"enable\":true}],\"nav\":[{\"type\":\"timepicker\",\"collapse\":false,\"notice\":false,\"status\":\"Stable\",\"time_options\":[\"5m\",\"15m\",\"30m\",\"1h\",\"3h\",\"6h\",\"12h\",\"24h\",\"2d\",\"3d\",\"5d\",\"7d\",\"15d\"],\"refresh_intervals\":[\"30s\",\"1m\",\"5m\",\"15m\",\"30m\",\"1h\"],\"timefield\":\"@timestamp\",\"enable\":true,\"now\":true,\"filter_id\":0}],\"refresh\":false}"

    dashboard = json.loads(dashboard)

    dashboard['services']['filter']['list']['4']['query'] = org_id
    dashboard['services']['filter']['list']['2']['value'] = netloc
    dashboard = str(dashboard)
    dashboard = dashboard.replace("'", '"')
    # dashboard = dashboard.replace('"', '\\"')
    # dashboard = dashboard.replace(' \"', '\\"')
    dashboard = dashboard.replace(': "', ':"')
    dashboard = dashboard.replace(', "', ',"')
    dashboard = dashboard.replace(': ', ':')
    # dashboard = dashboard.replace('"', '\\"')
    dashboard = dashboard.replace('True', 'true')
    dashboard = dashboard.replace('False', 'false')
    dashboard = dashboard.replace(', ', ',')
    dashboard = dashboard.replace(f'"organization_id\",\"query\":\"{org_id}\"',
                                  f'"organization_id\",\"query\":\"{org_id}\"')
    dashboard = dashboard.replace('None', 'null')
    dashboard = dashboard.replace('netlocs,users,status codes,xheaders', 'netlocs, users, status codes, xheaders')
    dashboard = dashboard.replace('netlocs,users,ban rules', 'netlocs, users, ban rules')
    dashboard = dashboard.replace('slave IPs,slave providers', 'slave IPs, slave providers')
    # dashboard = dashboard.replace(', \\', ',\\')
    # dashboard = dashboard.replace('""', '"')

    url = f"{kibana_int}"
    # print(json.loads(str(dashboard)))
    payload = json.dumps({
        "user": "guest",
        "group": "guest",
        "title": "crawlera-mukthy",
        "dashboard": f'{dashboard}'
    })
    print(payload)
    headers = {
        'Authorization': f'Basic {auth_key}',
        'Content-Type': 'application/json',
        'User-Agent': 'PostmanRuntime/7.29.2'
    }

    response = requests.request("POST", url, headers=headers, data=payload)
    temp_token = json.loads(response.text)
    temp_token = temp_token['_id']
    temp_url = f'{kibana_temp}{temp_token}'
    # print(temp_url)
    return temp_url
